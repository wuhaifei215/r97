<?php
/**
 *  /api/notify.php   （或放在任意可直接访问的目录下）
 *
 *  目的：外部（如支付平台）回调时直接执行 Pay 模块的 TreealPayController::notifyurl()
 *  说明：在加载 ThinkPHP 之前强制把模块设为 Pay，并手动导入 Controller
 */

/* -------------------------------------------------
   1️⃣ 先把模块锁定为 Pay（必须在加载框架之前执行）
   ------------------------------------------------- */
$_GET['g'] = 'Payment';                // ThinkPHP 3.2.4 使用 $_GET['g'] 来决定模块
$_GET['c'] = 'TreealPayDF';          // ThinkPHP 3.2.4 使用 $_GET['c'] 来决定控制器
$_GET['a'] = 'notifyurl';          // ThinkPHP 3.2.4 使用 $_GET['a'] 来决定方法
define('BIND_MODULE','Pay');       // TP3.2.4 支持 BIND_MODULE

/* -------------------------------------------------
   2️⃣ 定义 Application 目录的完整路径
   ------------------------------------------------- */
if (!defined('APP_PATH')) {
    define('APP_PATH', dirname(__DIR__) . '/Application/');
}

/* -------------------------------------------------
   3️⃣ 加载 ThinkPHP 正确的入口文件
   ------------------------------------------------- */
require dirname(__DIR__) . '/core/ThinkPHP.php';   // 官方默认路径

/* -------------------------------------------------
   4️⃣ ThinkPHP 会自动根据 $_GET['g']、$_GET['c']、$_GET['a'] 来执行对应的方法
   ------------------------------------------------- */
// 不需要手动导入和实例化，ThinkPHP 会自动处理

/* -------------------------------------------------
   5️⃣ 结束脚本，防止 ThinkPHP 再渲染默认模板
   ------------------------------------------------- */
exit;
