<?php
/**
 *  /api/notify.php   ← 任何可以直接被浏览器/支付平台访问的路径
 *
 *  目的：直接执行 Pay 模块下的 TreealPayAction::notifyurl()
 *  思路：在加载 ThinkPHP 前强制模块为 Pay，并手动定义 MODULE_NAME。
 */

/*-------------------------------------------------
 1. 强制把当前请求的模块设为 Pay
    必须在加载 ThinkPHP 之前完成
 -------------------------------------------------*/
$_GET['g']     = 'Pay';               // 让 ThinkPHP 解析时看到模块参数
$_REQUEST['g'] = 'Pay';               // 防止某些入口使用 REQUEST

/*-------------------------------------------------
 2. 手动定义 MODULE_NAME 常量，防止后续代码把它改回默认（Home）
 -------------------------------------------------*/
if (!defined('MODULE_NAME')) {
    define('MODULE_NAME', 'Pay');
}

/*-------------------------------------------------
 3. 定义 Application 目录的绝对路径
 -------------------------------------------------*/
if (!defined('APP_PATH')) {
    // 本文件在 /api/，Application 与 /api 同层
    define('APP_PATH', dirname(__DIR__) . '/Application/');
}

/*-------------------------------------------------
 4. 加载 ThinkPHP 核心文件
 -------------------------------------------------*/
require dirname(__DIR__) . '/core/ThinkPHP.php';

/*-------------------------------------------------
 5. 调用 Pay 模块下的 TreealPay 控制器的 notifyurl 方法
    推荐使用 R()（路由调用），它会自动实例化并执行
 -------------------------------------------------*/
R('Pay/TreealPay/notifyurl');   // 完整的模块/控制器/方法路径

/*-------------------------------------------------
 6. 防止 ThinkPHP 继续渲染默认模板
 -------------------------------------------------*/
exit;
